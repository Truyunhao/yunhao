<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C/C++ Mobile Editor Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --editor-bg: #0d1117;
            --editor-fg: #c9d1d9;
            --kw-color: #ff7b72;
            --str-color: #a5d6ff;
            --comment-color: #8b949e;
            --func-color: #d2a8ff;
            --type-color: #ffa657;
            --caret-color: #58a6ff;
        }

        .theme-github-dark { --editor-bg: #0d1117; --editor-fg: #c9d1d9; --kw-color: #ff7b72; --str-color: #a5d6ff; --comment-color: #8b949e; --func-color: #d2a8ff; --type-color: #ffa657; }
        .theme-monokai { --editor-bg: #272822; --editor-fg: #f8f8f2; --kw-color: #f92672; --str-color: #e6db74; --comment-color: #75715e; --func-color: #a6e22e; --type-color: #66d9ef; }
        .theme-dracula { --editor-bg: #282a36; --editor-fg: #f8f8f2; --kw-color: #ff79c6; --str-color: #f1fa8c; --comment-color: #6272a4; --func-color: #50fa7b; --type-color: #8be9fd; }
        .theme-vs-dark { --editor-bg: #1e1e1e; --editor-fg: #d4d4d4; --kw-color: #569cd6; --str-color: #ce9178; --comment-color: #6a9955; --func-color: #dcdcaa; --type-color: #4ec9b0; }

        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .editor-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--editor-bg);
        }

        #editor-textarea, #highlight-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 15px;
            font-family: inherit;
            line-height: 1.5;
            tab-size: 2;
            white-space: pre;
            word-wrap: normal;
            border: none;
            outline: none;
            box-sizing: border-box;
        }

        #editor-textarea {
            background: transparent;
            color: transparent;
            caret-color: var(--caret-color);
            resize: none;
            z-index: 2;
        }

        #highlight-layer {
            color: var(--editor-fg);
            z-index: 1;
            pointer-events: none;
            overflow-y: auto;
        }

        .hl-kw { color: var(--kw-color); font-weight: bold; }
        .hl-str { color: var(--str-color); }
        .hl-comment { color: var(--comment-color); font-style: italic; }
        .hl-func { color: var(--func-color); }
        .hl-type { color: var(--type-color); }
        .hl-num { color: #d19a66; }

        .accessory-bar {
            background: #202020;
            border-top: 1px solid #333;
            z-index: 10;
        }

        .key-btn {
            background: #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s, background 0.2s;
            width: 100%;
        }

        .key-btn:active {
            transform: scale(0.92);
            background: #444;
        }

        .grid-wrap {
            display: grid;
            width: 100%;
            gap: 8px;
            grid-template-columns: repeat(auto-fill, minmax(var(--btn-w, 34px), 1fr));
        }

        #snippet-area {
            grid-template-columns: repeat(auto-fill, minmax(var(--snip-w, 68px), 1fr));
        }

        .radio-tag {
            cursor: pointer;
            padding: 2px 10px;
            border-radius: 999px;
            font-size: 11px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .radio-tag.active {
            background: #3b82f6;
            color: white;
        }

        .param-input:focus {
            outline: none;
            background: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=range] {
            -webkit-appearance: none;
            background: #333;
            height: 4px;
            border-radius: 2px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 6px rgba(0,0,0,0.5);
        }

        .foldable-content {
            max-height: 1000px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .foldable-content.collapsed {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
        }

        .param-adjuster-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            width: 100%;
        }

        .slider-inputs-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        @media (max-width: 767px) {
            .slider-inputs-group { max-width: 320px; }
            #quick-slider { flex: 1; }
        }

        @media (min-width: 768px) {
            .param-adjuster-container { flex-direction: row; justify-content: space-between; }
            .slider-inputs-group { width: auto; justify-content: flex-end; gap: 16px; }
            #quick-slider { width: 140px; }
        }

        #settings-panel {
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #settings-panel.active { transform: translateY(0); }
        #settings-overlay { display: none; z-index: 40; }
        #settings-overlay.active { display: block; }

        #snippet-toggle-icon { cursor: pointer; transition: color 0.2s; }
        #snippet-toggle-icon:hover { color: #3b82f6; }

        #toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(59, 130, 246, 0.95);
            color: white;
            padding: 8px 20px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: bold;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        #toast.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body class="theme-github-dark">

    <div id="toast">代码已复制到剪贴板</div>

    <header class="h-14 bg-[#1a1a1a] flex items-center justify-between px-4 border-b border-gray-800 shrink-0">
        <div class="flex items-center space-x-2">
            <i class="fas fa-code text-blue-400"></i>
            <span id="lang-indicator" class="font-bold text-sm text-gray-300">C</span>
        </div>
        <div class="flex items-center space-x-4 text-lg text-gray-400">
            <button onclick="copyCode()" title="复制代码"><i class="far fa-copy"></i></button>
            <button id="download-btn" title="下载"><i class="fas fa-download"></i></button>
            <button onclick="clearAll()" title="清空代码"><i class="fas fa-trash-alt"></i></button>
            <button onclick="toggleSettings()" title="设置"><i class="fas fa-cog"></i></button>
        </div>
    </header>

    <main class="editor-container">
        <div id="highlight-layer"></div>
        <textarea id="editor-textarea" spellcheck="false" placeholder="在此输入代码..."></textarea>
    </main>

    <div id="accessory-bar" class="accessory-bar p-3">
        <!-- 参数调节区域 -->
        <div id="param-adjusters" class="max-h-0 opacity-0 overflow-hidden transition-all duration-300">
            <div class="param-adjuster-container pb-3 border-b border-gray-800 mb-3">
                <div id="target-selector" class="flex space-x-1 shrink-0">
                    <div class="radio-tag active" data-target="control">控制行</div>
                    <div class="radio-tag" data-target="symbol">符号矩阵</div>
                    <div class="radio-tag" data-target="snippet">快捷代码</div>
                </div>

                <div class="slider-inputs-group">
                    <div class="flex-grow flex items-center">
                        <input type="range" id="quick-slider" class="w-full" min="0" max="100" value="0">
                    </div>
                    <div class="flex space-x-1 text-[10px] shrink-0">
                        <div class="flex flex-col items-center">
                            <span class="text-gray-500 mb-0.5 scale-90">宽</span>
                            <input type="number" id="input-width" data-prop="width" class="param-input bg-[#2d2d2d] w-9 h-6 text-center rounded border border-gray-700">
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="text-gray-500 mb-0.5 scale-90">高</span>
                            <input type="number" id="input-height" data-prop="height" class="param-input bg-[#2d2d2d] w-9 h-6 text-center rounded border border-gray-700">
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="text-gray-500 mb-0.5 scale-90">圆角</span>
                            <input type="number" id="input-radius" data-prop="radius" class="param-input bg-[#2d2d2d] w-8 h-6 text-center rounded border border-gray-700">
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="text-gray-500 mb-0.5 scale-90">字号</span>
                            <input type="number" id="input-fontsize" data-prop="fontSize" class="param-input bg-[#2d2d2d] w-8 h-6 text-center rounded border border-gray-700">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 辅助栏核心控制行 -->
        <div id="control-line" class="flex justify-between items-center mb-2">
            <div class="flex space-x-2">
                <div class="key-btn control-key w-12 h-9 text-xs font-bold shrink-0" onclick="insertTab()">Tab</div>
                <div id="toggle-params-btn" class="key-btn control-key w-10 h-9 bg-blue-900/40 text-blue-400 shrink-0" onclick="toggleParamArea()">
                    <i class="fas fa-sliders-h"></i>
                </div>
                <!-- 眼睛按钮已移至参数设置按钮右边 -->
                <div id="snippet-eye-wrapper" class="flex items-center ml-1">
                    <i id="snippet-toggle-icon" class="fas fa-eye text-gray-400 text-lg p-2" onclick="toggleSnippetVisibility()" title="切换快捷代码显示"></i>
                </div>
            </div>
            <div class="flex space-x-2">
                <div class="key-btn control-key w-10 h-9 shrink-0" onclick="undo()"><i class="fas fa-undo"></i></div>
                <div class="key-btn control-key w-10 h-9 shrink-0" onclick="redo()"><i class="fas fa-redo"></i></div>
                <div class="key-btn control-key w-10 h-9 shrink-0" onclick="toggleMainArea()"><i id="fold-icon" class="fas fa-chevron-down"></i></div>
            </div>
        </div>

        <div id="foldable-main" class="foldable-content space-y-3">
            <div id="symbol-area" class="grid-wrap"></div>
            <div id="snippet-area" class="grid-wrap pt-1 border-t border-gray-800"></div>
        </div>
    </div>

    <div id="settings-overlay" class="fixed inset-0 bg-black/60" onclick="toggleSettings()"></div>

    <div id="settings-panel" class="fixed bottom-0 left-0 right-0 bg-[#252525] p-6 rounded-t-2xl shadow-2xl border-t border-gray-700 z-50">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-bold text-white">编辑器偏好</h2>
            <button onclick="toggleSettings()" class="w-10 h-10 flex items-center justify-center text-gray-400 bg-white/5 rounded-full"><i class="fas fa-times"></i></button>
        </div>
        <div class="space-y-6">
            <div class="flex justify-between items-center text-sm">
                <span>缩进空格</span>
                <select id="setting-indent" class="bg-[#333] px-3 py-1 rounded border border-gray-600">
                    <option value="2" selected>2 空格</option>
                    <option value="4">4 空格</option>
                </select>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-sm"><span>主字体大小</span><span id="font-size-val">16px</span></div>
                <input type="range" id="setting-fontsize" min="10" max="24" value="16" class="w-full">
            </div>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="setTheme('github-dark')" class="text-[10px] bg-[#0d1117] py-3 rounded border border-gray-700 hover:border-blue-500">GitHub Dark</button>
                <button onclick="setTheme('monokai')" class="text-[10px] bg-[#272822] py-3 rounded border border-gray-700 hover:border-blue-500">Monokai</button>
                <button onclick="setTheme('dracula')" class="text-[10px] bg-[#282a36] py-3 rounded border border-gray-700 hover:border-blue-500">Dracula</button>
                <button onclick="setTheme('vs-dark')" class="text-[10px] bg-[#1e1e1e] py-3 rounded border border-gray-700 hover:border-blue-500">VS Dark</button>
            </div>
        </div>
    </div>

    <script>
        const textarea = document.getElementById('editor-textarea');
        const highlightLayer = document.getElementById('highlight-layer');
        const settingsPanel = document.getElementById('settings-panel');
        const settingsOverlay = document.getElementById('settings-overlay');
        const quickSlider = document.getElementById('quick-slider');
        const toast = document.getElementById('toast');
        
        let config = {
            indentSize: 2,
            fontSize: 16,
            showParams: false,
            showSnippetArea: true,
            currentTarget: 'control',
            activeInput: null,
            params: {
                control: { width: 45, height: 36, radius: 4, fontSize: 13 },
                symbol: { width: 34, height: 34, radius: 4, fontSize: 13 },
                snippet: { width: 68, height: 32, radius: 4, fontSize: 12 }
            }
        };

        let history = [""];
        let historyIdx = 0;

        window.onload = () => {
            initUI();
            initListeners();
            applyConfig();
            handleInput();
        };

        function initUI() {
            const symbols = ["#", "(", ")", "[", "]", "{", "}", "<", ">", "_", "&", ".", "->", "\"", "'", "*", "!", "=", "+", "-", "/", "\\", "%", ":", ";"];
            const symbolArea = document.getElementById('symbol-area');
            symbolArea.innerHTML = '';
            symbols.forEach(s => {
                const btn = document.createElement('div');
                btn.className = 'key-btn symbol-key';
                btn.innerText = s;
                btn.onclick = () => insertText(s);
                symbolArea.appendChild(btn);
            });

            const snippets = ["include", "define", "if", "else", "switch", "break", "for", "while", "do", "return", "main"];
            const snippetArea = document.getElementById('snippet-area');
            snippetArea.innerHTML = '';
            snippets.forEach(snip => {
                const btn = document.createElement('div');
                btn.className = 'key-btn snippet-key';
                btn.innerText = snip;
                btn.onclick = () => insertSnippet(snip);
                snippetArea.appendChild(btn);
            });
        }

        function initListeners() {
            document.querySelectorAll('.radio-tag').forEach(tag => {
                tag.onclick = function() {
                    document.querySelectorAll('.radio-tag').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    config.currentTarget = this.dataset.target;
                    syncInputValues();
                    if (config.activeInput) updateSliderRange();
                };
            });

            document.querySelectorAll('.param-input').forEach(input => {
                input.onfocus = function() { config.activeInput = this; updateSliderRange(); };
                input.oninput = function() {
                    const prop = this.dataset.prop;
                    const val = parseInt(this.value) || 0;
                    config.params[config.currentTarget][prop] = val;
                    updateKeyStyles();
                    quickSlider.value = val;
                };
            });

            quickSlider.oninput = function() {
                if (!config.activeInput) return;
                const val = parseInt(this.value);
                const prop = config.activeInput.dataset.prop;
                config.activeInput.value = val;
                config.params[config.currentTarget][prop] = val;
                updateKeyStyles();
            };

            window.addEventListener('resize', updateKeyStyles);
            document.getElementById('setting-indent').onchange = (e) => { config.indentSize = parseInt(e.target.value); applyConfig(); };
            document.getElementById('setting-fontsize').oninput = (e) => { config.fontSize = parseInt(e.target.value); applyConfig(); };
        }

        function toggleSnippetVisibility() {
            config.showSnippetArea = !config.showSnippetArea;
            const snipArea = document.getElementById('snippet-area');
            const eyeIcon = document.getElementById('snippet-toggle-icon');
            if (config.showSnippetArea) {
                snipArea.style.display = 'grid';
                eyeIcon.className = 'fas fa-eye text-blue-400 text-lg p-2';
            } else {
                snipArea.style.display = 'none';
                eyeIcon.className = 'fas fa-eye-slash text-gray-600 text-lg p-2';
            }
        }

        function updateSliderRange() {
            if (!config.activeInput) return;
            const prop = config.activeInput.dataset.prop;
            const currentVal = config.params[config.currentTarget][prop];
            let min = 5, max = 100;
            if (prop === 'width') { min = 20; max = 200; }
            else if (prop === 'height') { min = 15; max = 80; }
            else if (prop === 'radius') { min = 0; max = 40; }
            else if (prop === 'fontSize') { min = 8; max = 24; }
            quickSlider.min = min; quickSlider.max = max; quickSlider.value = currentVal;
        }

        function syncInputValues() {
            const p = config.params[config.currentTarget];
            document.getElementById('input-width').value = p.width;
            document.getElementById('input-height').value = p.height;
            document.getElementById('input-radius').value = p.radius;
            document.getElementById('input-fontsize').value = p.fontSize;
        }

        function updateKeyStyles() {
            const cp = config.params.control;
            document.querySelectorAll('.control-key').forEach(btn => {
                if(!btn.id.includes('toggle')) btn.style.width = cp.width + 'px';
                btn.style.height = cp.height + 'px';
                btn.style.borderRadius = cp.radius + 'px';
                btn.style.fontSize = cp.fontSize + 'px';
            });
            const sp = config.params.symbol;
            document.getElementById('symbol-area').style.setProperty('--btn-w', sp.width + 'px');
            document.querySelectorAll('.symbol-key').forEach(btn => {
                btn.style.height = sp.height + 'px';
                btn.style.borderRadius = sp.radius + 'px';
                btn.style.fontSize = sp.fontSize + 'px';
            });
            const snp = config.params.snippet;
            document.getElementById('snippet-area').style.setProperty('--snip-w', snp.width + 'px');
            document.querySelectorAll('.snippet-key').forEach(btn => {
                btn.style.height = snp.height + 'px';
                btn.style.borderRadius = snp.radius + 'px';
                btn.style.fontSize = snp.fontSize + 'px';
            });
        }

        function applyConfig() {
            textarea.style.fontSize = config.fontSize + 'px';
            highlightLayer.style.fontSize = config.fontSize + 'px';
            textarea.style.tabSize = config.indentSize;
            highlightLayer.style.tabSize = config.indentSize;
            document.getElementById('font-size-val').innerText = config.fontSize + 'px';
            syncInputValues();
            updateKeyStyles();
        }

        function highlight(code) {
            const keywords = /\b(if|else|switch|case|default|while|do|for|break|continue|return|sizeof|typedef|struct|include|define|int|char|float|double|void|long|auto|std|vector|bool)\b/g;
            const strings = /"(\\.|[^"\\])*"|'(\\.|[^'\\])*'/g;
            const comments = /\/\/.+?(\n|$)|(\/\*[\s\S]*?\*\/)/g;
            const numbers = /\b\d+(\.\d+)?\b/g;
            let html = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            html = html.replace(comments, m => `<span class="hl-comment">${m}</span>`);
            html = html.replace(strings, m => `<span class="hl-str">${m}</span>`);
            html = html.replace(keywords, m => `<span class="hl-kw">${m}</span>`);
            html = html.replace(numbers, m => `<span class="hl-num">${m}</span>`);
            return html + "\n";
        }

        function handleInput() {
            const code = textarea.value;
            highlightLayer.innerHTML = highlight(code);
            syncScroll();
            if (history[historyIdx] !== code) {
                history = history.slice(0, historyIdx + 1);
                history.push(code);
                if (history.length > 50) history.shift(); else historyIdx++;
            }
        }

        function syncScroll() {
            highlightLayer.scrollTop = textarea.scrollTop;
            highlightLayer.scrollLeft = textarea.scrollLeft;
        }

        textarea.oninput = handleInput;
        textarea.onscroll = syncScroll;

        function insertAtCursor(text) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            textarea.value = textarea.value.substring(0, start) + text + textarea.value.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + text.length;
            if ("vibrate" in navigator) navigator.vibrate(5);
        }

        function insertText(text) { insertAtCursor(text); textarea.focus(); handleInput(); }
        function insertTab() { insertText(" ".repeat(config.indentSize)); }
        function undo() { if (historyIdx > 0) { historyIdx--; textarea.value = history[historyIdx]; handleInput(); } }
        function redo() { if (historyIdx < history.length - 1) { historyIdx++; textarea.value = history[historyIdx]; handleInput(); } }
        
        function toggleParamArea() {
            config.showParams = !config.showParams;
            const area = document.getElementById('param-adjusters');
            if (config.showParams) {
                area.style.maxHeight = '200px'; area.style.opacity = '1';
                area.style.marginTop = '0.5rem'; area.style.marginBottom = '0.75rem';
            } else {
                area.style.maxHeight = '0'; area.style.opacity = '0';
                area.style.marginTop = '0'; area.style.marginBottom = '0';
            }
        }

        function toggleMainArea() {
            const main = document.getElementById('foldable-main');
            const isCollapsed = main.classList.toggle('collapsed');
            document.getElementById('fold-icon').className = isCollapsed ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
        }

        function toggleSettings() { 
            settingsPanel.classList.toggle('active'); 
            settingsOverlay.classList.toggle('active');
        }

        function setTheme(theme) { document.body.className = 'theme-' + theme; toggleSettings(); }
        
        function copyCode() {
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            try {
                if (document.execCommand('copy')) showToast();
            } catch (err) {}
            textarea.setSelectionRange(textarea.selectionEnd, textarea.selectionEnd);
            textarea.blur();
        }

        function showToast() {
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2000);
        }

        function clearAll() { if (confirm("确定要清空所有代码吗？")) { textarea.value = ""; handleInput(); } }

        function insertSnippet(type) {
            let text = "";
            switch(type) {
                case 'include': text = "#include <stdio.h>\n"; break;
                case 'main': text = "int main() {\n    \n    return 0;\n}"; break;
                default: text = type + " ";
            }
            insertAtCursor(text); textarea.focus(); handleInput();
        }
    </script>
</body>
</html>